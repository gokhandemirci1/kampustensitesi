<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli - KampÃ¼sten</title>
    <link rel="stylesheet" href="css/style.css">
      <link rel="icon" href="logo1.svg" type="image/x-icon">
    <style>
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
            text-align: center;
        }
        .stat-card h4 {
            margin: 0 0 0.5rem 0;
            color: #666;
            font-size: 0.9rem;
        }
        .stat-card .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--text-color);
            margin: 0;
        }
        .teacher-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .teacher-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }
        .teacher-card.pending {
            border-left: 5px solid #ffc107;
        }
        .teacher-card.approved {
            border-left: 5px solid #28a745;
        }
        .teacher-header {
            display: flex;
            gap: 1.5rem;
            align-items: start;
            margin-bottom: 1rem;
        }
        .teacher-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            box-shadow: 0 4px 10px rgba(255, 222, 89, 0.3);
        }
        .teacher-photo-placeholder {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color) 0%, #ffed80 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-color);
            border: 3px solid var(--primary-color);
        }
        .teacher-info {
            flex: 1;
        }
        .teacher-info h3 {
            margin: 0 0 0.5rem 0;
            color: var(--text-color);
        }
        .teacher-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
            color: #666;
        }
        .content-preview {
            margin-top: 1rem;
            padding: 1rem;
            background: #f9f9f9;
            border-radius: 10px;
        }
        .content-preview h4 {
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }
        .content-item-small {
            padding: 0.5rem;
            background: white;
            margin: 0.5rem 0;
            border-radius: 5px;
            border-left: 3px solid var(--primary-color);
        }
        .student-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            border-left: 4px solid #17a2b8;
        }
        .student-card.pending {
            border-left-color: #ffc107;
        }
        .student-card.approved {
            border-left-color: #28a745;
        }
        .payment-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .camp-class-select {
            margin-top: 1rem;
            padding: 1rem;
            background: #f0f8ff;
            border-radius: 10px;
            border: 2px dashed #4a90e2;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="container">
                <div class="logo">
                    <img src="images/logo.svg" alt="KampÃ¼sten Logo" class="logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <h1 style="display: none;">KampÃ¼sten</h1>
                </div>
                <ul class="nav-menu">
                    <li><a href="#" onclick="logout()">Ã‡Ä±kÄ±ÅŸ Yap</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="dashboard">
        <div class="container">
            <div class="dashboard-header">
                <h2 class="dashboard-title">Admin Paneli</h2>
                <p id="welcomeMessage">HoÅŸ geldiniz!</p>
                <div class="dashboard-nav">
                    <a href="#" onclick="showSection('stats')" class="active" id="nav-stats">ğŸ“Š Ä°statistikler</a>
                    <a href="#" onclick="showSection('teachers')" id="nav-teachers">ğŸ‘¨â€ğŸ« Ã–ÄŸretmen OnaylarÄ±</a>
                    <a href="#" onclick="showSection('pending-payments')" id="nav-pending-payments">ğŸ’° Bekleyen Ã–demeler</a>
                    <a href="#" onclick="showSection('students')" id="nav-students">ğŸ‘¥ Ã–ÄŸrenci YÃ¶netimi</a>
                    <a href="#" onclick="showSection('camps')" id="nav-camps">ğŸ¯ Kamp YÃ¶netimi</a>
                </div>
            </div>

            <!-- Statistics Section -->
            <div id="section-stats" class="section">
                <div class="card">
                    <h3 class="card-title">Genel Ä°statistikler</h3>
                    <div class="admin-stats-grid">
                        <div class="stat-card">
                            <h4>Toplam Ã–ÄŸrenci</h4>
                            <p class="stat-value" id="stat-students">-</p>
                        </div>
                        <div class="stat-card">
                            <h4>Toplam Ã–ÄŸretmen</h4>
                            <p class="stat-value" id="stat-teachers">-</p>
                        </div>
                        <div class="stat-card">
                            <h4>Onay Bekleyen Ã–ÄŸretmen</h4>
                            <p class="stat-value" id="stat-pending-teachers">-</p>
                        </div>
                        <div class="stat-card">
                            <h4>OnaylÄ± Ã–ÄŸretmen</h4>
                            <p class="stat-value" id="stat-approved-teachers">-</p>
                        </div>
                        <div class="stat-card">
                            <h4>Toplam Kamp</h4>
                            <p class="stat-value" id="stat-camps">-</p>
                        </div>
                        <div class="stat-card">
                            <h4>Toplam SÄ±nÄ±f</h4>
                            <p class="stat-value" id="stat-classes">-</p>
                        </div>
                        <div class="stat-card">
                            <h4>Bekleyen Ã–demeler</h4>
                            <p class="stat-value" id="stat-pending-payments">-</p>
                        </div>
                        <div class="stat-card">
                            <h4>Ã–demesi AlÄ±nmÄ±ÅŸ</h4>
                            <p class="stat-value" id="stat-paid-payments">-</p>
                        </div>
                        <div class="stat-card">
                            <h4>OnaylanmÄ±ÅŸ Ã–demeler</h4>
                            <p class="stat-value" id="stat-approved-payments">-</p>
                        </div>
                        <div class="stat-card">
                            <h4>Reddedilen Ã–demeler</h4>
                            <p class="stat-value" id="stat-rejected-payments">-</p>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <h3 class="card-title">Kamp Ä°statistikleri</h3>
                    <div id="campStatsList"></div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <h3 class="card-title">SÄ±nÄ±f Ä°statistikleri</h3>
                    <div id="classStatsList"></div>
                </div>
            </div>

            <!-- Teacher Approval Section -->
            <div id="section-teachers" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">Ã–ÄŸretmen OnaylarÄ±</h3>
                    <div style="margin-bottom: 1rem;">
                        <button class="btn btn-secondary" onclick="filterTeachers('all')">TÃ¼mÃ¼</button>
                        <button class="btn btn-secondary" onclick="filterTeachers('pending')">Bekleyenler</button>
                        <button class="btn btn-secondary" onclick="filterTeachers('approved')">Onaylananlar</button>
                    </div>
                    <div id="teachersList"></div>
                </div>
            </div>

            <!-- Pending Payments Section -->
            <div id="section-pending-payments" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">Bekleyen Ã–demeler</h3>
                    <p style="color: #666; margin-bottom: 1.5rem;">Ã–deme onayÄ± bekleyen Ã¶ÄŸrenciler. Ã–deme onaylandÄ±ktan sonra Ã¶ÄŸrenciyi sÄ±nÄ±fa atayabilirsiniz.</p>
                    <div id="pendingPaymentsList"></div>
                </div>
            </div>

            <!-- Students Management Section -->
            <div id="section-students" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">Ã–ÄŸrenci YÃ¶netimi</h3>
                    
                    <!-- Tabs -->
                    <div class="tabs" style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid #e0e0e0;">
                        <button class="tab-btn active" onclick="showStudentTab('pending')" id="tab-pending">
                            â³ Bekleyen Onaylar (<span id="pending-count">0</span>)
                        </button>
                        <button class="tab-btn" onclick="showStudentTab('approved')" id="tab-approved">
                            âœ… OnaylanmÄ±ÅŸ (<span id="approved-count">0</span>)
                        </button>
                        <button class="tab-btn" onclick="showStudentTab('rejected')" id="tab-rejected">
                            âŒ ReddedilmiÅŸ (<span id="rejected-count">0</span>)
                        </button>
                    </div>
                    
                    <!-- Pending Approvals Tab -->
                    <div id="student-tab-pending" class="student-tab-content">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ad Soyad</th>
                                        <th>E-posta</th>
                                        <th>Telefon</th>
                                        <th>Kamp</th>
                                        <th>Fiyat</th>
                                        <th>KayÄ±t Tarihi</th>
                                        <th>Ä°ÅŸlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="pendingStudentsTable"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Approved Tab -->
                    <div id="student-tab-approved" class="student-tab-content" style="display: none;">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ad Soyad</th>
                                        <th>E-posta</th>
                                        <th>Telefon</th>
                                        <th>Kamp</th>
                                        <th>SÄ±nÄ±f</th>
                                        <th>Ã–ÄŸretmen</th>
                                        <th>Ã–deme Durumu</th>
                                        <th>KayÄ±t Tarihi</th>
                                    </tr>
                                </thead>
                                <tbody id="approvedStudentsTable"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Rejected Tab -->
                    <div id="student-tab-rejected" class="student-tab-content" style="display: none;">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ad Soyad</th>
                                        <th>E-posta</th>
                                        <th>Telefon</th>
                                        <th>Kamp</th>
                                        <th>Fiyat</th>
                                        <th>Reddetme Nedeni</th>
                                        <th>KayÄ±t Tarihi</th>
                                    </tr>
                                </thead>
                                <tbody id="rejectedStudentsTable"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Camps Management Section -->
            <div id="section-camps" class="section" style="display: none;">
                <div class="card">
                    <h3 class="card-title">Yeni Kamp OluÅŸtur</h3>
                    <form id="createCampForm">
                        <div class="form-group">
                            <label for="campName">Kamp AdÄ±</label>
                            <input type="text" id="campName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="campDescription">AÃ§Ä±klama</label>
                            <textarea id="campDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="campPrice">Fiyat (TL)</label>
                            <input type="number" id="campPrice" name="price" step="0.01" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Kamp OluÅŸtur</button>
                    </form>
                </div>
                <div class="card" style="margin-top: 2rem;">
                    <h3 class="card-title">Mevcut Kamplar</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Ad</th>
                                    <th>AÃ§Ä±klama</th>
                                    <th>Fiyat</th>
                                    <th>Ã–ÄŸretmenler</th>
                                    <th>Ä°ÅŸlemler</th>
                                </tr>
                            </thead>
                            <tbody id="campsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Teacher Detail Modal -->
    <div id="teacherModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('teacherModal')">&times;</span>
            <h3>Ã–ÄŸretmen DetaylarÄ±</h3>
            <div id="teacherModalContent"></div>
        </div>
    </div>

    <!-- Reject Teacher Modal -->
    <div id="rejectTeacherModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('rejectTeacherModal')">&times;</span>
            <h3>Ã–ÄŸretmeni Reddet</h3>
            <form id="rejectTeacherForm">
                <input type="hidden" id="rejectTeacherId" name="teacher_id">
                <div class="form-group">
                    <label for="rejectReason">Reddetme Nedeni</label>
                    <textarea id="rejectReason" name="reason" rows="4" required placeholder="Ã–ÄŸretmeni neden reddettiÄŸinizi aÃ§Ä±klayÄ±n..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-danger">Reddet</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('rejectTeacherModal')">Ä°ptal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Payment Approval Modal -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('paymentModal')">&times;</span>
            <h3>Ã–deme OnayÄ±</h3>
            <div id="paymentModalContent"></div>
        </div>
    </div>

    <!-- Payment Reject Modal -->
    <div id="rejectPaymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('rejectPaymentModal')">&times;</span>
            <h3>Ã–demeyi Reddet</h3>
            <form id="rejectPaymentForm">
                <input type="hidden" id="rejectPaymentId" name="enrollment_id">
                <div class="form-group">
                    <label for="rejectPaymentReason">Reddetme Nedeni</label>
                    <textarea id="rejectPaymentReason" name="reason" rows="4" required placeholder="Ã–deme neden reddedildi?"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-danger">Reddet</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('rejectPaymentModal')">Ä°ptal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Reject Student Enrollment Modal -->
    <div id="rejectStudentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('rejectStudentModal')">&times;</span>
            <h3>Ã–ÄŸrenci KaydÄ±nÄ± Reddet</h3>
            <form id="rejectStudentForm">
                <input type="hidden" id="rejectStudentEnrollmentId" name="enrollment_id">
                <div class="form-group">
                    <label for="rejectStudentReason">Reddetme Nedeni</label>
                    <select id="rejectStudentReason" name="rejection_reason" required style="width: 100%; padding: 0.8rem; margin-top: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="">SeÃ§iniz...</option>
                        <option value="could_not_contact">Ä°letiÅŸim kurulamadÄ±</option>
                        <option value="price_too_high">Fiyat Ã§ok yÃ¼ksek</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-danger">Reddet</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('rejectStudentModal')">Ä°ptal</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Assign Teacher Modal -->
    <div id="assignTeacherModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('assignTeacherModal')">&times;</span>
            <h3>Kampa Ã–ÄŸretmen Ata</h3>
            <div id="assignTeacherModalContent"></div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        // Check authentication
        if (!isAuthenticated() || getUser().role !== 'admin') {
            window.location.href = 'admin-login.html';
        }

        let allTeachers = [];
        let allStudents = [];
        let allEnrollments = [];
        let allCamps = [];
        let allClasses = [];
        let currentTeacherFilter = 'all';
        let currentStudentFilter = 'all';

        // Load user info
        function loadUserInfo() {
            const user = getUser();
            document.getElementById('welcomeMessage').textContent = `HoÅŸ geldiniz, ${user.email}!`;
        }

        // Show section
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.querySelectorAll('.dashboard-nav a').forEach(a => a.classList.remove('active'));
            document.getElementById(`section-${section}`).style.display = 'block';
            document.getElementById(`nav-${section}`).classList.add('active');
            
            if (section === 'stats') loadStats();
            if (section === 'teachers') loadTeachers();
            if (section === 'pending-payments') loadPendingPayments();
            if (section === 'students') loadStudents();
            if (section === 'camps') loadCamps();
        }

        // Load statistics
        async function loadStats() {
            try {
                const stats = await apiRequest('/admin/stats');
                
                document.getElementById('stat-students').textContent = stats.students;
                document.getElementById('stat-teachers').textContent = stats.teachers;
                document.getElementById('stat-pending-teachers').textContent = stats.pending_teachers;
                document.getElementById('stat-approved-teachers').textContent = stats.approved_teachers;
                document.getElementById('stat-camps').textContent = stats.camps;
                document.getElementById('stat-classes').textContent = stats.classes;
                document.getElementById('stat-pending-payments').textContent = stats.pending_payments;
                document.getElementById('stat-paid-payments').textContent = stats.paid_payments;
                document.getElementById('stat-approved-payments').textContent = stats.approved_payments;
                document.getElementById('stat-rejected-payments').textContent = stats.rejected_payments || 0;
                
                // Camp stats
                const campContainer = document.getElementById('campStatsList');
                campContainer.innerHTML = '';
                if (stats.camp_stats && stats.camp_stats.length > 0) {
                    stats.camp_stats.forEach(camp => {
                        const div = document.createElement('div');
                        div.className = 'card-item';
                        div.innerHTML = `
                            <h4>${camp.name}</h4>
                            <div class="teacher-details">
                                <span>Toplam KayÄ±t: <strong>${camp.total_enrollments}</strong></span>
                                <span>SÄ±nÄ±f SayÄ±sÄ±: <strong>${camp.total_classes}</strong></span>
                                <span>Bekleyen: <strong style="color: #ffc107;">${camp.pending}</strong></span>
                                <span>Ã–demesi AlÄ±nmÄ±ÅŸ: <strong style="color: #17a2b8;">${camp.paid}</strong></span>
                                <span>OnaylanmÄ±ÅŸ: <strong style="color: #28a745;">${camp.approved}</strong></span>
                            </div>
                        `;
                        campContainer.appendChild(div);
                    });
                } else {
                    campContainer.innerHTML = '<p>HenÃ¼z kamp istatistiÄŸi yok.</p>';
                }
                
                // Class stats
                const classContainer = document.getElementById('classStatsList');
                classContainer.innerHTML = '';
                if (stats.class_stats && stats.class_stats.length > 0) {
                    stats.class_stats.forEach(cls => {
                        const div = document.createElement('div');
                        div.className = 'card-item';
                        div.innerHTML = `
                            <h4>${cls.name}</h4>
                            <div class="teacher-details">
                                <span>Toplam Ã–ÄŸrenci: <strong>${cls.total_students}</strong></span>
                                <span>OnaylanmÄ±ÅŸ: <strong style="color: #28a745;">${cls.approved_students}</strong></span>
                            </div>
                        `;
                        classContainer.appendChild(div);
                    });
                } else {
                    classContainer.innerHTML = '<p>HenÃ¼z sÄ±nÄ±f istatistiÄŸi yok.</p>';
                }
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // Load teachers
        async function loadTeachers() {
            try {
                allTeachers = await apiRequest('/teachers');
                filterTeachers(currentTeacherFilter);
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // Filter teachers
        function filterTeachers(filter) {
            currentTeacherFilter = filter;
            const filtered = filter === 'all' 
                ? allTeachers 
                : filter === 'pending'
                ? allTeachers.filter(t => !t.approved)
                : allTeachers.filter(t => t.approved);
            
            displayTeachers(filtered);
        }

        // Display teachers
        async function displayTeachers(teachers) {
            const container = document.getElementById('teachersList');
            container.innerHTML = '';
            
            if (teachers.length === 0) {
                container.innerHTML = '<p>Ã–ÄŸretmen bulunamadÄ±.</p>';
                return;
            }
            
            for (const teacher of teachers) {
                const card = document.createElement('div');
                card.className = `teacher-card ${teacher.approved ? 'approved' : 'pending'}`;
                
                // Load teacher content
                let contentHtml = '';
                if (teacher.approved) {
                    try {
                        const content = await apiRequest(`/admin/teachers/${teacher.id}/content`);
                        if (content.length > 0) {
                            contentHtml = '<div class="content-preview"><h4>YÃ¼klenen Ä°Ã§erikler:</h4>';
                            content.slice(0, 3).forEach(item => {
                                contentHtml += `<div class="content-item-small"><strong>${item.title}</strong> - ${item.class_name || 'SÄ±nÄ±f'}</div>`;
                            });
                            if (content.length > 3) {
                                contentHtml += `<p style="margin-top: 0.5rem; color: #666;">+ ${content.length - 3} iÃ§erik daha...</p>`;
                            }
                            contentHtml += '</div>';
                        }
                    } catch (error) {
                        console.error('Error loading teacher content:', error);
                    }
                }
                
                const profileImg = teacher.profile_photo 
                    ? `<img src="${teacher.profile_photo}" alt="${teacher.first_name} ${teacher.last_name}" class="teacher-photo">`
                    : `<div class="teacher-photo-placeholder">${teacher.first_name?.charAt(0) || ''}${teacher.last_name?.charAt(0) || ''}</div>`;
                
                card.innerHTML = `
                    <div class="teacher-header">
                        ${profileImg}
                        <div class="teacher-info">
                            <h3>${teacher.first_name} ${teacher.last_name}</h3>
                            <div class="teacher-details">
                                <span>ğŸ“§ ${teacher.email}</span>
                                <span>ğŸ“ ${teacher.phone || 'BelirtilmemiÅŸ'}</span>
                                <span>ğŸ“š ${teacher.field_of_study || 'BelirtilmemiÅŸ'}</span>
                                <span>ğŸ“ ${teacher.university || 'BelirtilmemiÅŸ'}</span>
                                <span>ğŸ“… ${new Date(teacher.created_at).toLocaleDateString('tr-TR')}</span>
                            </div>
                            ${contentHtml}
                        </div>
                    </div>
                    <div class="payment-actions">
                        ${!teacher.approved ? `
                            <button class="btn btn-success" onclick="approveTeacher(${teacher.id})">âœ… Onayla</button>
                            <button class="btn btn-danger" onclick="showRejectTeacherModal(${teacher.id})">âŒ Reddet</button>
                        ` : `
                            <span style="color: #28a745; font-weight: bold;">âœ“ OnaylanmÄ±ÅŸ</span>
                        `}
                        <button class="btn btn-secondary" onclick="viewTeacherDetails(${teacher.id})">ğŸ‘ï¸ Detaylar</button>
                    </div>
                `;
                container.appendChild(card);
            }
        }

        // Approve teacher
        async function approveTeacher(id) {
            if (!confirm('Bu Ã¶ÄŸretmeni onaylamak istediÄŸinize emin misiniz?')) return;
            
            try {
                await apiRequest(`/teachers/approve/${id}`, { method: 'POST' });
                showAlert('Ã–ÄŸretmen onaylandÄ±!', 'success');
                loadTeachers();
                loadStats();
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // Show reject teacher modal
        function showRejectTeacherModal(id) {
            document.getElementById('rejectTeacherId').value = id;
            document.getElementById('rejectTeacherModal').style.display = 'block';
        }

        // Reject teacher
        document.getElementById('rejectTeacherForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            if (!confirm('Bu Ã¶ÄŸretmeni reddetmek istediÄŸinize emin misiniz? Hesap silinecek.')) return;
            
            try {
                await apiRequest(`/teachers/reject/${data.teacher_id}`, {
                    method: 'POST',
                    body: JSON.stringify({ reason: data.reason })
                });
                showAlert('Ã–ÄŸretmen reddedildi ve silindi!', 'success');
                closeModal('rejectTeacherModal');
                e.target.reset();
                loadTeachers();
                loadStats();
            } catch (error) {
                showAlert(error.message, 'error');
            }
        });

        // View teacher details
        async function viewTeacherDetails(id) {
            const teacher = allTeachers.find(t => t.id === id);
            if (!teacher) return;
            
            let contentHtml = '';
            try {
                const content = await apiRequest(`/admin/teachers/${id}/content`);
                if (content.length > 0) {
                    contentHtml = '<h4>YÃ¼klenen Ä°Ã§erikler:</h4><div style="max-height: 300px; overflow-y: auto;">';
                    content.forEach(item => {
                        contentHtml += `
                            <div class="content-item-small">
                                <strong>${item.title}</strong><br>
                                <small>SÄ±nÄ±f: ${item.class_name || 'Bilinmiyor'}</small><br>
                                <small>${item.description || ''}</small>
                                ${item.file_path ? `<br><a href="${item.file_path}" target="_blank" style="color: #0066cc;">DosyayÄ± GÃ¶rÃ¼ntÃ¼le</a>` : ''}
                            </div>
                        `;
                    });
                    contentHtml += '</div>';
                } else {
                    contentHtml = '<p>HenÃ¼z iÃ§erik yÃ¼klenmemiÅŸ.</p>';
                }
            } catch (error) {
                contentHtml = '<p>Ä°Ã§erikler yÃ¼klenirken hata oluÅŸtu.</p>';
            }
            
            const profileImg = teacher.profile_photo 
                ? `<img src="${teacher.profile_photo}" alt="${teacher.first_name} ${teacher.last_name}" class="teacher-photo" style="width: 150px; height: 150px;">`
                : `<div class="teacher-photo-placeholder" style="width: 150px; height: 150px; font-size: 3rem;">${teacher.first_name?.charAt(0) || ''}${teacher.last_name?.charAt(0) || ''}</div>`;
            
            document.getElementById('teacherModalContent').innerHTML = `
                <div class="teacher-header">
                    ${profileImg}
                    <div class="teacher-info">
                        <h3>${teacher.first_name} ${teacher.last_name}</h3>
                        <div class="teacher-details">
                            <span><strong>E-posta:</strong> ${teacher.email}</span>
                            <span><strong>Telefon:</strong> ${teacher.phone || 'BelirtilmemiÅŸ'}</span>
                            <span><strong>Alan:</strong> ${teacher.field_of_study || 'BelirtilmemiÅŸ'}</span>
                            <span><strong>Ãœniversite:</strong> ${teacher.university || 'BelirtilmemiÅŸ'}</span>
                            <span><strong>KayÄ±t Tarihi:</strong> ${new Date(teacher.created_at).toLocaleString('tr-TR')}</span>
                            <span><strong>Durum:</strong> ${teacher.approved ? '<span style="color: #28a745;">OnaylÄ±</span>' : '<span style="color: #ffc107;">Beklemede</span>'}</span>
                        </div>
                        ${contentHtml}
                    </div>
                </div>
            `;
            document.getElementById('teacherModal').style.display = 'block';
        }

        // Load pending payments
        async function loadPendingPayments() {
            try {
                allEnrollments = await apiRequest('/admin/enrollments');
                allCamps = await apiRequest('/camps');
                allClasses = await apiRequest('/admin/classes');
                
                const pending = allEnrollments.filter(e => e.payment_status === 'pending' || e.payment_status === 'paid');
                displayPendingPayments(pending);
            } catch (error) {
                showAlert(error.message, 'error');
                console.error('Load pending payments error:', error);
            }
        }

        // Display pending payments
        function displayPendingPayments(enrollments) {
            const container = document.getElementById('pendingPaymentsList');
            container.innerHTML = '';
            
            if (enrollments.length === 0) {
                container.innerHTML = '<p>Bekleyen Ã¶deme bulunamadÄ±.</p>';
                return;
            }
            
            enrollments.forEach(enrollment => {
                const card = document.createElement('div');
                card.className = `student-card ${enrollment.payment_status}`;
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap;">
                        <div style="flex: 1;">
                            <h4>${enrollment.student_name}</h4>
                            <div class="teacher-details">
                                <span>ğŸ“§ ${enrollment.student_email}</span>
                                <span>ğŸ“ ${enrollment.student_phone || 'BelirtilmemiÅŸ'}</span>
                                <span>ğŸ¯ Kamp: ${enrollment.camp_name}</span>
                                <span>ğŸ’° Fiyat: ${enrollment.camp_price} TL</span>
                                ${enrollment.teacher_name ? `<span>ğŸ‘¨â€ğŸ« Ã–ÄŸretmen: ${enrollment.teacher_name}</span>` : ''}
                                ${enrollment.class_name ? `<span>ğŸ“š SÄ±nÄ±f: ${enrollment.class_name}</span>` : ''}
                            </div>
                            <div style="margin-top: 1rem;">
                                ${getPaymentStatusBadge(enrollment.payment_status)}
                            </div>
                        </div>
                    </div>
                    <div class="payment-actions">
                        ${enrollment.payment_status === 'pending' ? `
                            <button class="btn btn-success" onclick="showPaymentApprovalModal(${enrollment.id})">ğŸ’° Ã–deme AlÄ±ndÄ±</button>
                            <button class="btn btn-danger" onclick="showRejectPaymentModal(${enrollment.id})">âŒ Ã–demeyi Reddet</button>
                        ` : enrollment.payment_status === 'paid' ? `
                            <button class="btn btn-primary" onclick="showPaymentApprovalModal(${enrollment.id})">âœ… Onayla ve SÄ±nÄ±fa Ata</button>
                        ` : ''}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Show payment approval modal
        async function showPaymentApprovalModal(enrollmentId) {
            const enrollment = allEnrollments.find(e => e.id === enrollmentId);
            if (!enrollment) return;
            
            // Get available classes for this camp
            const campClasses = allClasses.filter(c => c.camp_id === enrollment.camp_id);
            let classSelectHtml = '';
            
            if (enrollment.payment_status === 'paid' && campClasses.length > 0) {
                classSelectHtml = `
                    <div class="camp-class-select">
                        <label><strong>SÄ±nÄ±f SeÃ§in (Ã–deme onaylandÄ±ktan sonra Ã¶ÄŸrenci bu sÄ±nÄ±fa atanacak):</strong></label>
                        <select id="approvalClassId" class="form-group" style="width: 100%; padding: 0.8rem; margin-top: 0.5rem;">
                            <option value="">SÄ±nÄ±f seÃ§in...</option>
                            ${campClasses.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                        </select>
                    </div>
                `;
            }
            
            document.getElementById('paymentModalContent').innerHTML = `
                <div class="student-card">
                    <h4>${enrollment.student_name}</h4>
                    <p><strong>Kamp:</strong> ${enrollment.camp_name}</p>
                    <p><strong>Fiyat:</strong> ${enrollment.camp_price} TL</p>
                    ${enrollment.teacher_name ? `<p><strong>Ã–ÄŸretmen:</strong> ${enrollment.teacher_name}</p>` : ''}
                    ${classSelectHtml}
                    <div class="payment-actions" style="margin-top: 1.5rem;">
                        <button class="btn btn-success" onclick="approvePayment(${enrollmentId})">${enrollment.payment_status === 'pending' ? 'Ã–deme AlÄ±ndÄ± Olarak Ä°ÅŸaretle' : 'Onayla ve SÄ±nÄ±fa Ata'}</button>
                        <button class="btn btn-secondary" onclick="closeModal('paymentModal')">Ä°ptal</button>
                    </div>
                </div>
            `;
            document.getElementById('paymentModal').style.display = 'block';
        }

        // Approve payment
        async function approvePayment(enrollmentId) {
            const enrollment = allEnrollments.find(e => e.id === enrollmentId);
            if (!enrollment) return;
            
            const classSelect = document.getElementById('approvalClassId');
            const classId = classSelect ? classSelect.value : null;
            
            if (enrollment.payment_status === 'paid' && !classId) {
                showAlert('LÃ¼tfen bir sÄ±nÄ±f seÃ§in!', 'error');
                return;
            }
            
            const confirmMsg = enrollment.payment_status === 'pending' 
                ? 'Ã–deme alÄ±ndÄ± olarak iÅŸaretlemek istediÄŸinize emin misiniz?'
                : 'Ã–ÄŸrenciyi onaylayÄ±p sÄ±nÄ±fa atamak istediÄŸinize emin misiniz?';
            
            if (!confirm(confirmMsg)) return;
            
            try {
                const status = enrollment.payment_status === 'pending' ? 'paid' : 'approved';
                await apiRequest(`/admin/enrollments/${enrollmentId}/payment`, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        payment_status: status,
                        class_id: classId || enrollment.class_id
                    })
                });
                
                showAlert(enrollment.payment_status === 'pending' ? 'Ã–deme alÄ±ndÄ± olarak iÅŸaretlendi!' : 'Ã–ÄŸrenci onaylandÄ± ve sÄ±nÄ±fa atandÄ±!', 'success');
                closeModal('paymentModal');
                loadPendingPayments();
                loadStudents();
                loadStats();
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // Show reject payment modal
        function showRejectPaymentModal(enrollmentId) {
            document.getElementById('rejectPaymentId').value = enrollmentId;
            document.getElementById('rejectPaymentModal').style.display = 'block';
        }

        // Reject payment
        document.getElementById('rejectPaymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            if (!confirm('Ã–demeyi reddetmek istediÄŸinize emin misiniz?')) return;
            
            try {
                await apiRequest(`/admin/enrollments/${data.enrollment_id}/payment`, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        payment_status: 'rejected',
                        reason: data.reason
                    })
                });
                showAlert('Ã–deme reddedildi!', 'success');
                closeModal('rejectPaymentModal');
                e.target.reset();
                loadPendingPayments();
                loadStudents();
                loadStats();
            } catch (error) {
                showAlert(error.message, 'error');
            }
        });

        // Reject student enrollment
        document.getElementById('rejectStudentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            const enrollment = allEnrollments.find(e => e.id === parseInt(data.enrollment_id));
            const warningMsg = enrollment && enrollment.class_name 
                ? `Bu Ã¶ÄŸrenci "${enrollment.class_name}" sÄ±nÄ±fÄ±na atanmÄ±ÅŸ. Reddetme durumunda sÄ±nÄ±f kaydÄ± ve eriÅŸimi kaldÄ±rÄ±lacak. Devam etmek istediÄŸinize emin misiniz?`
                : 'Bu Ã¶ÄŸrenci kaydÄ±nÄ± reddetmek istediÄŸinize emin misiniz?';
            
            if (!confirm(warningMsg)) return;
            
            try {
                await apiRequest(`/admin/enrollments/${data.enrollment_id}/approval`, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        approval_status: 'rejected',
                        rejection_reason: data.rejection_reason
                    })
                });
                showAlert('Ã–ÄŸrenci kaydÄ± reddedildi ve sÄ±nÄ±f eriÅŸimi kaldÄ±rÄ±ldÄ±!', 'success');
                closeModal('rejectStudentModal');
                e.target.reset();
                // Remove info div
                const infoDiv = document.querySelector('#rejectStudentModal .reject-info');
                if (infoDiv) infoDiv.remove();
                loadStudents();
                loadStats();
            } catch (error) {
                showAlert(error.message, 'error');
            }
        });

        let currentStudentTab = 'pending';

        // Show student tab
        function showStudentTab(tab) {
            currentStudentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            // Show/hide tab content
            document.querySelectorAll('.student-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`student-tab-${tab}`).style.display = 'block';
            
            // Load data for the selected tab
            loadStudents();
        }

        // Load students
        async function loadStudents() {
            try {
                allStudents = await apiRequest('/admin/users');
                allEnrollments = await apiRequest('/admin/enrollments');
                allClasses = await apiRequest('/admin/classes');
                
                // Update counts
                const pending = allEnrollments.filter(e => e.approval_status === 'pending' || !e.approval_status).length;
                const approved = allEnrollments.filter(e => e.approval_status === 'approved').length;
                const rejected = allEnrollments.filter(e => e.approval_status === 'rejected').length;
                
                document.getElementById('pending-count').textContent = pending;
                document.getElementById('approved-count').textContent = approved;
                document.getElementById('rejected-count').textContent = rejected;
                
                // Display based on current tab
                if (currentStudentTab === 'pending') {
                    displayPendingStudents();
                } else if (currentStudentTab === 'approved') {
                    displayApprovedStudents();
                } else if (currentStudentTab === 'rejected') {
                    displayRejectedStudents();
                }
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // Display pending students
        function displayPendingStudents() {
            const tbody = document.getElementById('pendingStudentsTable');
            tbody.innerHTML = '';
            
            const pendingEnrollments = allEnrollments.filter(e => e.approval_status === 'pending' || !e.approval_status);
            
            if (pendingEnrollments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Bekleyen onay bulunamadÄ±.</td></tr>';
                return;
            }
            
            pendingEnrollments.forEach(enrollment => {
                const student = allStudents.find(s => s.id === enrollment.student_id);
                if (!student) return;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${student.first_name || ''} ${student.last_name || ''}</td>
                    <td>${student.email}</td>
                    <td>${student.phone || 'BelirtilmemiÅŸ'}</td>
                    <td>${enrollment.camp_name}</td>
                    <td>${enrollment.camp_price} TL</td>
                    <td>${new Date(enrollment.enrolled_at).toLocaleDateString('tr-TR')}</td>
                    <td>
                        <button class="btn btn-success" onclick="showApproveStudentModal(${enrollment.id})" style="margin-right: 0.5rem;">ğŸ’° Ã–deme AlÄ±ndÄ±</button>
                        <button class="btn btn-danger" onclick="showRejectStudentModal(${enrollment.id})">âŒ Reddet</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Display approved students
        function displayApprovedStudents() {
            const tbody = document.getElementById('approvedStudentsTable');
            tbody.innerHTML = '';
            
            const approvedEnrollments = allEnrollments.filter(e => e.approval_status === 'approved');
            
            if (approvedEnrollments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem;">OnaylanmÄ±ÅŸ Ã¶ÄŸrenci bulunamadÄ±.</td></tr>';
                return;
            }
            
            approvedEnrollments.forEach(enrollment => {
                const student = allStudents.find(s => s.id === enrollment.student_id);
                if (!student) return;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${student.first_name || ''} ${student.last_name || ''}</td>
                    <td>${student.email}</td>
                    <td>${student.phone || 'BelirtilmemiÅŸ'}</td>
                    <td>${enrollment.camp_name}</td>
                    <td>${enrollment.class_name || 'AtanmadÄ±'}</td>
                    <td>${enrollment.teacher_name || 'SeÃ§ilmedi'}</td>
                    <td>${getPaymentStatusBadge(enrollment.payment_status)}</td>
                    <td>${new Date(enrollment.enrolled_at).toLocaleDateString('tr-TR')}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Display rejected students
        function displayRejectedStudents() {
            const tbody = document.getElementById('rejectedStudentsTable');
            tbody.innerHTML = '';
            
            const rejectedEnrollments = allEnrollments.filter(e => e.approval_status === 'rejected');
            
            if (rejectedEnrollments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">ReddedilmiÅŸ Ã¶ÄŸrenci bulunamadÄ±.</td></tr>';
                return;
            }
            
            rejectedEnrollments.forEach(enrollment => {
                const student = allStudents.find(s => s.id === enrollment.student_id);
                if (!student) return;
                
                const rejectionReasonText = {
                    'could_not_contact': 'Ä°letiÅŸim kurulamadÄ±',
                    'price_too_high': 'Fiyat Ã§ok yÃ¼ksek'
                };
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${student.first_name || ''} ${student.last_name || ''}</td>
                    <td>${student.email}</td>
                    <td>${student.phone || 'BelirtilmemiÅŸ'}</td>
                    <td>${enrollment.camp_name}</td>
                    <td>${enrollment.camp_price} TL</td>
                    <td><span style="color: #dc3545; font-weight: bold;">${rejectionReasonText[enrollment.rejection_reason] || enrollment.rejection_reason || 'BelirtilmemiÅŸ'}</span></td>
                    <td>${new Date(enrollment.enrolled_at).toLocaleDateString('tr-TR')}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Show approve student modal
        async function showApproveStudentModal(enrollmentId) {
            const enrollment = allEnrollments.find(e => e.id === enrollmentId);
            if (!enrollment) return;
            
            // Get available classes for this camp
            const campClasses = allClasses.filter(c => c.camp_id === enrollment.camp_id);
            let classSelectHtml = '';
            
            if (campClasses.length > 0) {
                classSelectHtml = `
                    <div class="camp-class-select" style="margin-top: 1rem;">
                        <label><strong>SÄ±nÄ±f SeÃ§in (Ã–ÄŸrenci bu sÄ±nÄ±fa atanacak):</strong></label>
                        <select id="approveStudentClassId" class="form-group" style="width: 100%; padding: 0.8rem; margin-top: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="">SÄ±nÄ±f seÃ§in...</option>
                            ${campClasses.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                        </select>
                    </div>
                `;
            } else {
                classSelectHtml = `
                    <div style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
                        <p style="margin: 0; color: #856404;">Bu kamp iÃ§in henÃ¼z sÄ±nÄ±f oluÅŸturulmamÄ±ÅŸ. Ã–ÄŸretmen sÄ±nÄ±f oluÅŸturduktan sonra Ã¶ÄŸrenciyi atayabilirsiniz.</p>
                    </div>
                `;
            }
            
            document.getElementById('paymentModalContent').innerHTML = `
                <div class="student-card">
                    <h4>${enrollment.student_name}</h4>
                    <p><strong>E-posta:</strong> ${enrollment.student_email}</p>
                    <p><strong>Telefon:</strong> ${enrollment.student_phone || 'BelirtilmemiÅŸ'}</p>
                    <p><strong>Kamp:</strong> ${enrollment.camp_name}</p>
                    <p><strong>Fiyat:</strong> ${enrollment.camp_price} TL</p>
                    ${classSelectHtml}
                    <div class="payment-actions" style="margin-top: 1.5rem;">
                        <button class="btn btn-success" onclick="approveStudentEnrollment(${enrollmentId})">âœ… Ã–demeyi Al ve Onayla</button>
                        <button class="btn btn-secondary" onclick="closeModal('paymentModal')">Ä°ptal</button>
                    </div>
                </div>
            `;
            document.getElementById('paymentModal').style.display = 'block';
        }

        // Approve student enrollment
        async function approveStudentEnrollment(enrollmentId) {
            const enrollment = allEnrollments.find(e => e.id === enrollmentId);
            if (!enrollment) return;
            
            const classSelect = document.getElementById('approveStudentClassId');
            const classId = classSelect ? classSelect.value : null;
            
            // Get available classes for this camp
            const campClasses = allClasses.filter(c => c.camp_id === enrollment.camp_id);
            
            if (campClasses.length > 0 && !classId) {
                showAlert('LÃ¼tfen bir sÄ±nÄ±f seÃ§in!', 'error');
                return;
            }
            
            if (!confirm('Ã–demeyi aldÄ±ÄŸÄ±nÄ±zÄ± ve Ã¶ÄŸrenciyi onaylamak istediÄŸinize emin misiniz? Ã–ÄŸrenci sÄ±nÄ±f iÃ§eriklerine eriÅŸebilecek.')) return;
            
            try {
                await apiRequest(`/admin/enrollments/${enrollmentId}/approval`, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        approval_status: 'approved',
                        class_id: classId
                    })
                });
                
                showAlert('Ã–ÄŸrenci kaydÄ± onaylandÄ± ve sÄ±nÄ±fa atandÄ±!', 'success');
                closeModal('paymentModal');
                loadStudents();
                loadStats();
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // Show reject student modal
        function showRejectStudentModal(enrollmentId) {
            const enrollment = allEnrollments.find(e => e.id === enrollmentId);
            if (!enrollment) return;
            
            document.getElementById('rejectStudentEnrollmentId').value = enrollmentId;
            
            // Show enrollment info in modal
            const modalContent = document.querySelector('#rejectStudentModal .modal-content');
            const existingInfo = modalContent.querySelector('.reject-info');
            if (existingInfo) existingInfo.remove();
            
            const infoDiv = document.createElement('div');
            infoDiv.className = 'reject-info';
            infoDiv.style.cssText = 'margin-bottom: 1.5rem; padding: 1rem; background: #f9f9f9; border-radius: 5px;';
            infoDiv.innerHTML = `
                <p><strong>Ã–ÄŸrenci:</strong> ${enrollment.student_name}</p>
                <p><strong>Kamp:</strong> ${enrollment.camp_name} - ${enrollment.camp_price} TL</p>
                ${enrollment.class_name ? `<p style="color: #dc3545;"><strong>UyarÄ±:</strong> Ã–ÄŸrenci "${enrollment.class_name}" sÄ±nÄ±fÄ±na atanmÄ±ÅŸ. Reddetme durumunda sÄ±nÄ±f kaydÄ± ve eriÅŸimi kaldÄ±rÄ±lacak.</p>` : ''}
            `;
            modalContent.insertBefore(infoDiv, modalContent.querySelector('form'));
            
            document.getElementById('rejectStudentModal').style.display = 'block';
        }

        // Get payment status badge
        function getPaymentStatusBadge(status) {
            const badges = {
                'pending': '<span style="background: #ffc107; color: #000; padding: 0.3rem 0.8rem; border-radius: 15px; font-weight: bold; display: inline-block; margin-top: 0.5rem;">â³ Ã–demesi AlÄ±nmamÄ±ÅŸ</span>',
                'paid': '<span style="background: #17a2b8; color: #fff; padding: 0.3rem 0.8rem; border-radius: 15px; font-weight: bold; display: inline-block; margin-top: 0.5rem;">ğŸ’° Ã–demesi AlÄ±nmÄ±ÅŸ</span>',
                'approved': '<span style="background: #28a745; color: #fff; padding: 0.3rem 0.8rem; border-radius: 15px; font-weight: bold; display: inline-block; margin-top: 0.5rem;">âœ… OnaylanmÄ±ÅŸ</span>',
                'rejected': '<span style="background: #dc3545; color: #fff; padding: 0.3rem 0.8rem; border-radius: 15px; font-weight: bold; display: inline-block; margin-top: 0.5rem;">âŒ Reddedildi</span>'
            };
            return badges[status] || badges['pending'];
        }

        // Load camps
        async function loadCamps() {
            try {
                allCamps = await apiRequest('/camps');
                allClasses = await apiRequest('/admin/classes');
                const allUsers = await apiRequest('/admin/users');
                const teachers = allUsers.filter(u => u.role === 'teacher' && u.approved);
                
                const tbody = document.getElementById('campsTableBody');
                tbody.innerHTML = '';
                
                allCamps.forEach(camp => {
                    // Get teachers for this camp
                    const campClasses = allClasses.filter(c => c.camp_id === camp.id);
                    const campTeacherIds = [...new Set(campClasses.map(c => c.teacher_id))];
                    const campTeachers = teachers.filter(t => campTeacherIds.includes(t.id));
                    
                    let teachersHtml = '';
                    if (campTeachers.length > 0) {
                        teachersHtml = campTeachers.map(t => 
                            `<span style="display: inline-block; margin: 0.2rem; padding: 0.3rem 0.6rem; background: #e3f2fd; border-radius: 15px; font-size: 0.85rem;">${t.first_name} ${t.last_name}</span>`
                        ).join('');
                    } else {
                        teachersHtml = '<span style="color: #999;">Ã–ÄŸretmen atanmamÄ±ÅŸ</span>';
                    }
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${camp.id}</td>
                        <td>${camp.name}</td>
                        <td>${camp.description || ''}</td>
                        <td>${camp.price} TL</td>
                        <td style="max-width: 300px;">${teachersHtml}</td>
                        <td>
                            <button class="btn btn-primary" onclick="showAssignTeacherModal(${camp.id})" style="margin-right: 0.5rem;">ğŸ‘¨â€ğŸ« Ã–ÄŸretmen Ata</button>
                            <button class="btn btn-danger" onclick="deleteCamp(${camp.id})">Sil</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // Show assign teacher modal
        async function showAssignTeacherModal(campId) {
            const camp = allCamps.find(c => c.id === campId);
            if (!camp) return;
            
            // Get all approved teachers
            const allUsers = await apiRequest('/admin/users');
            const teachers = allUsers.filter(u => u.role === 'teacher' && u.approved);
            
            // Get teachers already assigned to this camp
            const campClasses = allClasses.filter(c => c.camp_id === campId);
            const assignedTeacherIds = [...new Set(campClasses.map(c => c.teacher_id))];
            const availableTeachers = teachers.filter(t => !assignedTeacherIds.includes(t.id));
            
            if (availableTeachers.length === 0) {
                showAlert('Bu kampa atanabilecek onaylÄ± Ã¶ÄŸretmen kalmadÄ±!', 'error');
                return;
            }
            
            let teacherSelectHtml = availableTeachers.map(t => 
                `<option value="${t.id}">${t.first_name} ${t.last_name} - ${t.email} (${t.field_of_study || 'Alan belirtilmemiÅŸ'})</option>`
            ).join('');
            
            document.getElementById('assignTeacherModalContent').innerHTML = `
                <div class="student-card">
                    <h4>Kamp: ${camp.name}</h4>
                    <p><strong>Fiyat:</strong> ${camp.price} TL</p>
                    <form id="assignTeacherForm">
                        <input type="hidden" name="camp_id" value="${campId}">
                        <div class="form-group">
                            <label for="assignTeacherSelect">Ã–ÄŸretmen SeÃ§in</label>
                            <select id="assignTeacherSelect" name="teacher_id" required style="width: 100%; padding: 0.8rem; margin-top: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="">Ã–ÄŸretmen seÃ§in...</option>
                                ${teacherSelectHtml}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="assignClassName">SÄ±nÄ±f AdÄ±</label>
                            <input type="text" id="assignClassName" name="class_name" placeholder="Ã–rn: Matematik SÄ±nÄ±fÄ±" style="width: 100%; padding: 0.8rem; margin-top: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                            <small style="color: #666; display: block; margin-top: 0.3rem;">BoÅŸ bÄ±rakÄ±lÄ±rsa otomatik oluÅŸturulur (Ã–ÄŸretmen AdÄ± - Kamp AdÄ±)</small>
                        </div>
                        <div class="payment-actions" style="margin-top: 1.5rem;">
                            <button type="submit" class="btn btn-success">âœ… Ã–ÄŸretmeni Ata</button>
                            <button type="button" class="btn btn-secondary" onclick="closeModal('assignTeacherModal')">Ä°ptal</button>
                        </div>
                    </form>
                </div>
            `;
            document.getElementById('assignTeacherModal').style.display = 'block';
        }

        // Create camp
        document.getElementById('createCampForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            data.price = parseFloat(data.price);
            
            try {
                await apiRequest('/camps', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                showAlert('Kamp oluÅŸturuldu!', 'success');
                e.target.reset();
                loadCamps();
                loadStats();
            } catch (error) {
                showAlert(error.message, 'error');
            }
        });

        // Assign teacher to camp
        document.addEventListener('submit', async (e) => {
            if (e.target.id === 'assignTeacherForm') {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);
                const campId = parseInt(data.camp_id);
                
                try {
                    await apiRequest(`/admin/camps/${campId}/assign-teacher`, {
                        method: 'POST',
                        body: JSON.stringify({
                            teacher_id: parseInt(data.teacher_id),
                            class_name: data.class_name || null
                        })
                    });
                    
                    showAlert('Ã–ÄŸretmen kampa atandÄ± ve sÄ±nÄ±f oluÅŸturuldu!', 'success');
                    closeModal('assignTeacherModal');
                    e.target.reset();
                    loadCamps();
                    loadStats();
                } catch (error) {
                    showAlert(error.message, 'error');
                }
            }
        });

        // Delete camp
        async function deleteCamp(id) {
            if (!confirm('Bu kampÄ± silmek istediÄŸinize emin misiniz?')) return;
            
            try {
                await apiRequest(`/camps/${id}`, { method: 'DELETE' });
                showAlert('Kamp silindi!', 'success');
                loadCamps();
                loadStats();
            } catch (error) {
                showAlert(error.message, 'error');
            }
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Logout
        function logout() {
            clearAuth();
            window.location.href = 'index.html';
        }

        // Initialize
        loadUserInfo();
        loadStats();
    </script>
</body>
</html>
